%%%%%%%%%%%%%%%%%%%%%%Ð¡ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½lyapunovÖ¸ï¿½ï¿½%%%%%%%%%%%%%%%%%%
%%%ï¿½ï¿½ï¿½ß£ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½
%%%ï¿½ï¿½Ä¿ï¿½ï¿½Ð¡ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½lyapunovÖ¸ï¿½ï¿½
%%%ï¿½ï¿½ï¿½Ú£ï¿½2009.11.29
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ë£ºï¿½Ã³ï¿½ï¿½ï¿½ï¿½ï¿½Aï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ó£¨µï¿½ï¿½ï¿½ï¿½ï¿½Ý£ï¿½ï¿½ï¿½FsÎªï¿½ï¿½ï¿½ï¿½Ä²ï¿½ï¿½ï¿½ï¿½ï¿?
%%ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½lamda_1ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Ãµï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Lyapunovï¿½ï¿½ï¿½ï¿½Öµï¿½ï¿½Ã¿window_t sï¿½ï¿½ï¿½ï¿½Ãµï¿½Ò»ï¿½ï¿½Öµï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Ê±Ã¿ï¿½ï¿½ï¿½Øµï¿½window_t/2 sï¿½ï¿½M_lyaÎªï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Lyapunovï¿½ï¿½Æ½ï¿½ï¿½Öµ
function [lambda_1,M_lya]=lyapunov_Rosentein(A,Fs,p)
% filename='F:\data\biyeshuju\slp14\wake\1.txt';
%A=load(input);
Fs=250;
%window_t=4;
%N=Fs*window_t;
N=length(A);
m=15;                %Ç¶ï¿½ï¿½Î¬ï¿½ï¿½
%tau=tau_def(data,N);%Ê±ï¿½ï¿½ï¿½Ó³ï¿½
delt_t=1/Fs;    %ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½
G=length(A);
g=Fs*2;%Ã¿ï¿½Î»ï¿½ï¿½ï¿½ï¿½Äµï¿½ï¿½ï¿½
t=((G-N)/g);
h=floor(t);
for ii=0:h%ï¿½ï¿½ï¿½ï¿½ï¿½Ä´ï¿½ï¿½ï¿½
    data=A(1+ii*g:N+ii*g);
    tau=tau_def(data);%Ê±ï¿½ï¿½ï¿½Ó³ï¿½
    P=period(data); %ï¿½ï¿½ï¿½Ðµï¿½Æ½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½
    Y=reconstitution(data,N,m,tau);%ï¿½ï¿½Õ¼ï¿½ï¿½Ø¹ï¿?
    M=N-(m-1)*tau;       %ï¿½Ø¹ï¿½ï¿½ï¿½Õ¼ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Ä¸ï¿½ï¿½ï¿?
 for j=1:M           %Ñ°ï¿½ï¿½ï¿½ï¿½Õ¼ï¿½ï¿½ï¿½Ã¿ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿?
     d_min=1.0e+15;
      for jj=1:M
          if abs(j-jj)>P %ï¿½ï¿½ï¿½Æ¶ï¿½ï¿½Ý·ï¿½ï¿½ï¿½
           d_s(j,jj)=norm((Y(:,j)-Y(:,jj)),2);
           if d_s(j,jj)<d_min
                        d_min=d_s(j,jj);
                        idx_j=jj;     %ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Õ¼ï¿½ï¿½ï¿½Ã¿ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Â±ï¿½
            end
          end
      end
    index(j)=idx_j;
    imax=min((M-j),(M-idx_j));%ï¿½ï¿½ï¿½ï¿½ï¿½jï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Ý»ï¿½Ê±ï¿½ä²½ï¿½ï¿½i
    for i=1:imax             
        d_j_i=0;
        d_j_i=norm((Y(:,j+i)-Y(:,idx_j+i)),2);   %ï¿½ï¿½ï¿½ï¿½ï¿½jï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Úµï¿½ï¿½ï¿½iï¿½ï¿½ï¿½ï¿½É¢ï¿½ï¿½ï¿½ï¿½Ä¾ï¿½ï¿½ï¿?
        d(i,j)=d_j_i;     %ï¿½ï¿½ï¿½i*jï¿½Ð¾ï¿½ï¿½ï¿½
    end
end
%ï¿½ï¿½Ã¿ï¿½ï¿½ï¿½Ý»ï¿½Ê±ï¿½ä²½ï¿½ï¿½iï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Ðµï¿½jï¿½ï¿½lnd(i,j)Æ½ï¿½ï¿½
[l_i,l_j]=size(d);
for i=1:l_i
    q=0;
    y_s=0;
    for j=1:l_j
        if d(i,j)~=0
            q=q+1; %ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½d(i,j)ï¿½ï¿½ï¿½ï¿½Ä¿
            y_s=y_s+log(d(i,j));
        end
    end
    y(i)=y_s/(q*delt_t);%ï¿½ï¿½Ã¿ï¿½ï¿½iï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Ðµï¿½jï¿½ï¿½lnd(i,j)Æ½ï¿½ï¿½
end
x=1:length(y);
% plot(x,y,'-o');
%  xlabel('x'); 
%  ylabel('y'); 
linearzone=[20:80];
Lya=polyfit(x(linearzone),y(linearzone),1);
% hold on;
lambda_1(ii+1)=Lya(1);
% filename ='F:\data\biyeshuju\slp14\wake\ly.txt';
end
M_lya=mean(lambda_1);
%if p==1
 %   plot(lambda_1);
end



         
              
              
